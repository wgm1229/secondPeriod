## 为本地浏览器配置用户cookie
> 因为我们歌曲数据使用QQ的，该平台对异常访问会有限制

1.node服务修改QQ配置
> QQMusicApi/bin/config.js
```
module.exports = {
  qq: '自己的QQ号', // 如果是微信号的，这里写 wxuin，可以在浏览器端登录后 cookie 中获取
  port: 3300,
  useDataStatistics: false, // 是否启用数据统计和ip拦截
}
```

2.在浏览器安装提取真实cookie的拓展插件
[插件地址](https://github.com/jsososo/qqmusic-cookie-porter)

+ 下载并解压压缩包

+ 新版Edge 打开 edge://extensions/，钩上左下角的开发者选项，把解压好的文件夹拖进去

+ 打开 https://y.qq.com，并登陆账号，会自动将 Cookie 信息存到 https://api.qq.jsososo.com 这台服务器上，然后自动跳转到 http://music.jsososo.com 再将刚才上传的 cookie 信息获取下来

3.登录网页qq音乐，通过插件提取真实用户cookie  （一大坨字符串）

4.在项目中封装一个专门用于设置cookie的组件
> components/SetCookie.vue    
这个代码大家可以直接复制使用，但是注意修改一下cookie 【！！！注意！！！】

5.点击歌曲列表，查看歌曲链接是否能够正常获取

6.audio.play()在谷歌浏览器中有报错，因为现在的谷歌浏览器需要有交互才能播放音频

## 歌曲进度条交互
1.能够根据音乐的播放进度，动态变化  
> props父子通信，在Player.vue中向Progress组件传递时间

Player.vue:
```
<Progress
:startTime= 'start' //传递参数
:endTime= 'end'
></Progress>
```
aduio的canplay事件，监听音频可以播放后，触发
aduio的timeupdate监听audio播放时间的变化
```
<audio 
:src='songurl'
@canplay="canplay"
@timeupdate="timeupdate"
ref="audio"
></audio>
```
```
methods: {
  canplay() {
    console.log('音乐可以播放了')
    let audio = this.$refs.audio
    console.log(audio.currentTime,audio.duration)
    let {currentTime,duration} = audio
    this.start = currentTime
    this.end = duration
    audio.play()
  },
  timeupdate(){
    let audio = this.$refs.audio
    let {currentTime,duration} = audio
    this.start = currentTime
  }
}
```

Progress组件
注意：props中的参数不能强制修改
```
<span>{{startTime | filterTime}}</span>
<span>{{endTime | filterTime}}</span>
```
```
props: {
        startTime: {type: Number,default: 0},
        endTime: {type: Number,default: 0},
    },
watch: {  //监听播放时间的变化，同步修改进度条宽度
    startTime() {
        let percent = (this.startTime/this.endTime)*100
        console.log(this.$refs.content)
        this.$refs.content.style.width = `${percent}%`
    }
},
```
2.手动拖拽进度条，改变音乐的播放位置
2.1按下的时候暂停播放，抬起的时候重新播放    vuex维护一个布尔值控制
store/player.js
```
export default {
  namespaced:true,
  state:()=>{
    return {
      isPlay:false  //控制音乐的播放状态,false代表暂停
    }
  },
  mutations:{
    isPlayMut(state,bool){ //根据用户传递的参数，改变播放状态
      state.isPlay = bool
    }
  }
}
```
store/index.js引用这个模块
```
import player from './player'

export default new Vuex.Store({
  modules: {
    player
  }
})
```

2.2使用子父通信  从Progess中传递新的播放时间给Player.vue
Progess
```
<div class='wrapper' 
      ref='wrapper' 
      @touchstart="handleStart" //移动端触发事件
      @touchmove="handleMove" 
      @touchend="handleEnd" 
      >
```
```
methods: {
    handleStart(e) {
      console.log(e);
      this.$store.commit('player/isPlayMut',false)  //按下进度条，暂停播放
      e.preventDefault();
    },
    handleMove(e) {
      // console.log(e);
      //提取wrapper的横轴偏移量
      let wrapper = this.$refs.wrapper;
      let offsetX = wrapper.getBoundingClientRect().left; //获取wrapper的偏移量
      let max = wrapper.getBoundingClientRect().width;
      let {clientX} = e.targetTouches[0]
      let distance = clientX - offsetX; //鼠标指针，相对于wrapper左端点的距离
      if(distance<=max&&distance>0){
        let percent = (distance / max)*100
        this.percent = percent;  //每次拽进度条，实时记录百分比
        this.$refs.content.style.width = `${percent}%`
      }
    },
    handleEnd(e) {
      this.$store.commit('player/isPlayMut',true)  //手指从进度条抬起，开启播放
      let {percent,endTime} = this;
      let t = percent*endTime/100;
      console.log('新的播放时间',t);
      this.$emit('trans-time',t)  //手指抬起的时候，想父级传递最新播放时间
    }
  }
```
Player.vue
    - 子组件中触发$emit('trans-time')
    - 父组件中使用Progress的时候，绑定@trans-time
    - 自定义事件触发父组件的事件函数，修改父组件audio的播放时间
```
<MyProgress
    :startTime = 'start'
    :endTime = 'end'
    @trans-time="handleNewTime"
    ></MyProgress>
```
```
handleNewTime(newTime){
        console.log(newTime);
        this.$refs.audio.currentTime = newTime;
      }
```
3.控制歌词的动态滚动

[获取元素相对屏幕偏移量](https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getBoundingClientRect)
[audio相关事件](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/audio#%E4%BA%8B%E4%BB%B6)

## vue过滤器
[过滤器](https://cn.vuejs.org/v2/guide/filters.html)
```
filters:{ //组件局部过滤器
    'filterTime':(value)=>{
      let time = parseInt(value); //秒为单位的时间
      let m = parseInt(time/60)
      let s = time % 60
      m = m<9 ? `0${m}` : m;
      s = s<9 ? `0${s}` : s;
      return m+':'+s   // 6:06
    }
  }
```

