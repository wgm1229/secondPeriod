## Redux状态管理
> Redux跟React，两者并非强绑定关系
> 我们可以在html中直接使用Redux


### 使用Redux的前提
> 项目中出现大量的跨组件共享的数据，就需要引入Redux

Redux的使⽤的三⼤原则：
1. Single Source of Truth(唯⼀的数据源)
2. State is read-only(状态是只读的)
3. Changes are made with pure function(数据的改变必须通过纯函数完成)

### 纯函数
> 纯函数，操作之后返回的结果是可预测的
+ 纯函数中不能返回随机数
+ 纯函数中不能出现异步请求

### Redux文档
[文档地址](https://cn.redux.js.org/)
Redux的核心概念
	+ Store   状态机，存放需要跨组件共享的数据
	+ reducer   为状态机服务，根据不同的action动作描述，返回不同的数据
	+ action   本质就是一个对象，用以表达用户的行为
	```
		{
			type:'increment',   //动作的行为是啥？（增加数字？减少数字？...）
			num:10             //本次动作的参数
		}
	```
	+ view    视图层，用户各个组件

### yarn常用命令
1.全局安装yarn
```
npm i yarn -g
```
2.查看镜像源
```
yarn config get registry
```

3.设置镜像源
选择淘宝镜像源
```
yarn config set registry https://registry.npm.taobao.org
```
4.安装项目所有依赖
```
yarn 
```
5.安装指定依赖
```
yarn add 包名    //生产依赖
yarn add 包名 --dev     //开发依赖
```
6.启动react项目
```
cd my-app
yarn start
```

## Redux的使用

1.安装Redux
```
yarn add redux
```
2.定义reducer
```
function NumReducer(state=100,action){
  console.log(state,action);
  switch (action.type) {
    case 'increment':
      return state + 1  //对状态机数据的增加操作
    case 'decrement':
      return state - 1  //对状态机数据的减少操作
    default:
      return state;  ////让状态机提供初始数据
  }
}

export default NumReducer
```
3.创建store状态机模块
```
import {createStore} from 'redux' 
import reducer from '../reducer/index.js'  //处理状态机数据交互逻辑的纯函数
const store = createStore(reducer)  //创建状态机实例
export default store
```
4.在Num.js中通过getState获取状态机初始化数据，并通过subscribe订阅数据变化
```
import store from '../../store/index.js' 

this.state = {
	count:0
}

componentDidMount(){
	this.setState({
		count:store.getState()  //提取状态机中初始化数据，设置给当前组件的state数据包
	})
	store.subscribe(()=>{
		console.log('Num组件订阅到了数据的变化',store.getState());
		this.setState({
			count: store.getState()  //提取状态机中新数据，设置给当前组件的state数据包
		})
	})
}

<h2>{this.state.count}</h2>
```
5.在Btn.js中，通过dispatch的方法，触发状态机数据变化
```
import store from '../../store'

<button onClick={()=>{
	store.dispatch({
		type:'increment'//对应render/index.js中的action.type
	})
}}>+</button>
```
6.store状态机提供的方法
	+ 提供 getState() 方法获取状态机当前数据；
	+ 提供 dispatch(action) 方法更新状态机中的数据；
	+ 通过 subscribe(listener) 订阅状态机数据的变化，执行listener回调函数;

## react状态管理的方案

1.redux   单独使用
> 状态机中的数据变化，需要在组件中进行手动订阅

2.redux + react-redux   结合使用
> 不需要手动订阅数据的变化


## react-redux使用流程
1.安装模块
```
yarn add react-redux
```

2.在index.js项目入口文件中，向跟组件注入store状态机
```
import store from './store'
import {Provider} from 'react-redux'

ReactDOM.render(
	<Provider store={store}>
			<App />
	</Provider>,
  document.getElementById('root')
);
```

3.在Num.js中通过react-redux所提供的connect方法，提取状态机数据，并注入到Num组件的props里面
```
import {connect} from 'react-redux'

console.log('Num组件的props',this.props);
<h2>{this.props.count}</h2>

const mapStateToProps = (state)=>{ //此处的state就是Provider注入的store提供的数据
  return {  //return的内容，就是设置给Num组件的props
    count:state
  }
}
export default connect(mapStateToProps)(Num)
```
4.在Btn.js中通过react-redux所提供的connect方法，提取状态机dispatch，并注入到Btn组件的props里面
```
import {connect} from 'react-redux'

render() {
	let {incre,decre,children} = this.props //从props中提取方法与children参数
	return (
		<div>
			<button onClick={()=>{
				// console.log(this.props);
				children=='+' ? incre() : decre()
			}}>{children}</button>
		</div>
	)
}
const mapDispatchToProps = (dispatch)=>{  //此处的dispatch就是能够触发状态机变化的方法
  return { //此处return的对象，将会被注入到Btn组件的props中
    'incre':()=>{   
      return dispatch({ type: 'increment' })
    },
    'decre':()=>{
      return dispatch({type:'decrement'})
    }
  };
}

export default connect(null,mapDispatchToProps)(Btn)
```
5.connect(转移state数据,转移dispatch方法)(需要使用状态机数据或方法的组件)
```
import {connect} from 'react-redux'

const mapStateToProps = (state)=>{ 
  return {  
    数据:state //组件中调用this.props.数据
  }
}
const mapDispatchToProps = (dispatch)=>{  
  return { 
    '对象':()=>{    //组件中调用this.props.对象()
			//相当于调用render中的action.type下的代码
      return dispatch({ type: 'action.type' })
    },    
  };
}
export default connect(mapStateToProps, mapDispatchToProps)(containerName)
```
## 任务

1. 学会独立使用redux

2. 学会 redux+react-redux 结合使用


